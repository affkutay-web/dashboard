<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onwin Dashboard</title>
    <!-- Favicons -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ”—</text></svg>">
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.4.3/echarts.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Combined and Refined Styles -->
    <style>
        body { font-family: 'Inter', sans-serif; }
        .glass-effect { background: rgba(26, 31, 54, 0.8); backdrop-filter: blur(10px); border-bottom: 1px solid rgba(255, 255, 255, 0.1); }
        .hero-bg { background: linear-gradient(135deg, #1a1f36 0%, #4a90a4 100%); position: relative; overflow: hidden; }
        .card-hover { transition: all 0.3s ease; }
        .card-hover:hover { transform: translateY(-4px); box-shadow: 0 20px 40px rgba(0, 0, 0, 0.08); }
        .loading-pulse { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .modal-backdrop { background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px); }
        .slide-up { animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .status-badge { color: white; padding: 0.25rem 0.6rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 500; text-transform: capitalize; }
        .status-active { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .status-inactive { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .status-paused { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        .toggle-switch { position: relative; display: inline-block; width: 48px; height: 24px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #ccc; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background: linear-gradient(135deg, #4a90a4 0%, #2d5a87 100%); }
        input:checked + .slider:before { transform: translateX(24px); }
        .nav-tab { transition: all 0.3s ease; position: relative; color: rgba(255, 255, 255, 0.7); }
        .nav-tab:hover { color: white; }
        .nav-tab.active { color: white; background: rgba(255, 255, 255, 0.15); }
    </style>
</head>

<body class="bg-gray-100 min-h-screen">
    <!-- Main Navigation -->
    <nav class="glass-effect fixed top-0 left-0 right-0 z-50 px-4 py-3">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-gradient-to-r from-blue-600 to-teal-500 rounded-lg flex items-center justify-center">
                        <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/></svg>
                    </div>
                    <h1 class="text-white font-semibold text-lg">Onwin Dashboard</h1>
                </div>
                <div class="hidden md:flex items-center bg-white bg-opacity-10 rounded-lg p-1 backdrop-filter backdrop-blur-lg">
                    <button class="nav-tab active px-4 py-1 rounded-md text-sm font-medium" data-page="page-dashboard">Dashboard</button>
                    <button class="nav-tab px-4 py-1 rounded-md text-sm font-medium" data-page="page-links">Links</button>
                    <button class="nav-tab px-4 py-1 rounded-md text-sm font-medium" data-page="page-settings">Settings</button>
                </div>
            </div>
            <div class="flex items-center space-x-4">
                <div class="hidden md:flex items-center space-x-2 text-white text-sm">
                    <div class="w-2 h-2 bg-green-400 rounded-full loading-pulse"></div>
                    <span id="lastUpdate">Updating...</span>
                </div>
                <button id="refreshBtn" class="p-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition-all">
                    <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>
                </button>
                <button id="mobileMenuBtn" class="md:hidden p-2 rounded-lg bg-white bg-opacity-20 hover:bg-opacity-30 transition-all">
                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                </button>
            </div>
        </div>
        <!-- Mobile Menu -->
        <div id="mobileMenu" class="hidden md:hidden bg-gray-800 bg-opacity-80 backdrop-filter backdrop-blur-lg mt-2 rounded-lg p-2">
            <button class="nav-tab active w-full text-left p-2 rounded-md" data-page="page-dashboard">Dashboard</button>
            <button class="nav-tab w-full text-left p-2 rounded-md" data-page="page-links">Links</button>
            <button class="nav-tab w-full text-left p-2 rounded-md" data-page="page-settings">Settings</button>
        </div>
    </nav>

    <main class="pt-20">
        <!-- Page: Dashboard -->
        <div id="page-dashboard" class="page-container">
            <div class="max-w-7xl mx-auto px-4">
                <div class="grid grid-cols-2 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white rounded-xl p-6 card-hover col-span-2 md:col-span-1"><h3 class="text-gray-600 text-sm font-medium mb-1">Total Clicks</h3><p class="text-3xl font-bold text-gray-900" id="totalClicks">0</p></div>
                    <div class="bg-white rounded-xl p-6 card-hover"><h3 class="text-gray-600 text-sm font-medium mb-1">Today's Clicks</h3><p class="text-3xl font-bold text-gray-900" id="todayClicks">0</p></div>
                    <div class="bg-white rounded-xl p-6 card-hover"><h3 class="text-gray-600 text-sm font-medium mb-1">Yesterday's Clicks</h3><p class="text-3xl font-bold text-gray-900" id="yesterdayClicks">0</p></div>
                    <div class="bg-white rounded-xl p-6 card-hover"><h3 class="text-gray-600 text-sm font-medium mb-1">Weekly Clicks</h3><p class="text-3xl font-bold text-gray-900" id="weeklyClicks">0</p></div>
                    <div class="bg-white rounded-xl p-6 card-hover"><h3 class="text-gray-600 text-sm font-medium mb-1">Monthly Clicks</h3><p class="text-3xl font-bold text-gray-900" id="monthlyClicks">0</p></div>
                    <div class="bg-white rounded-xl p-6 card-hover"><h3 class="text-gray-600 text-sm font-medium mb-1">Active Links</h3><p class="text-3xl font-bold text-gray-900" id="activeLinks">0</p></div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="lg:col-span-2 bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6">Performance Chart (Last 30 Days)</h3>
                        <div id="performanceChart" style="height: 300px;"></div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm p-6">
                        <h3 class="text-lg font-semibold text-gray-900 mb-6">Top Performing Links</h3>
                        <div id="topLinksContainer" class="space-y-4"><p class="text-gray-500">No data available.</p></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page: Link Management -->
        <div id="page-links" class="page-container hidden">
             <div class="max-w-7xl mx-auto px-4 py-6">
                <div class="flex flex-col md:flex-row items-start md:items-center justify-between mb-6 gap-4">
                     <div>
                        <h1 class="text-2xl font-semibold text-gray-900">Link Management</h1>
                        <p class="text-sm text-gray-500">Add, edit, and manage your short links.</p>
                    </div>
                    <button id="addLinkBtn" class="bg-gradient-to-r from-blue-600 to-teal-500 text-white px-4 py-2 rounded-lg hover:from-blue-700 hover:to-teal-600 transition-all flex items-center space-x-2 w-full md:w-auto">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                        <span>Add New Link</span>
                    </button>
                </div>
                <div id="linksGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                   <p class="text-gray-500 col-span-full">Loading links...</p>
                </div>
            </div>
        </div>

        <!-- Page: Settings -->
        <div id="page-settings" class="page-container hidden">
            <div class="max-w-4xl mx-auto px-4 py-6">
                 <div class="mb-6">
                    <h1 class="text-2xl font-semibold text-gray-900">Settings</h1>
                    <p class="text-sm text-gray-500">Configure your dashboard preferences.</p>
                </div>
                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                    <h2 class="text-lg font-semibold text-gray-900 mb-4">API Settings</h2>
                     <div>
                        <label for="apiKey" class="block text-sm font-medium text-gray-700 mb-1">Cuttly API Key</label>
                        <input type="password" id="apiKey" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                        <p class="text-xs text-gray-500 mt-1">Your API key is stored only in your browser and is required for creating new links.</p>
                    </div>
                </div>
                 <div class="flex justify-end">
                    <button id="saveSettings" class="bg-gradient-to-r from-blue-600 to-teal-500 text-white px-6 py-2 rounded-lg">
                        <span>Save Settings</span>
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Add/Edit Link Modal -->
    <div id="linkModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4 slide-up">
            <div class="p-6">
                <div class="flex items-center justify-between mb-4">
                    <h3 id="modalTitle" class="text-lg font-semibold text-gray-900">Add New Link</h3>
                    <button id="closeModal" class="text-gray-400 hover:text-gray-600 text-2xl font-bold">&times;</button>
                </div>
                <form id="linkForm" class="space-y-4">
                    <input type="hidden" id="linkId">
                    <div>
                        <label for="linkName" class="block text-sm font-medium text-gray-700 mb-1">Link Name (for your reference)</label>
                        <input type="text" id="linkName" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required>
                    </div>
                    <div>
                        <label for="originalUrl" class="block text-sm font-medium text-gray-700 mb-1">Original URL to Shorten</label>
                        <input type="url" id="originalUrl" class="w-full px-3 py-2 border border-gray-300 rounded-lg" required>
                    </div>
                     <div class="flex space-x-3 pt-4">
                        <button type="button" id="cancelBtn" class="flex-1 px-4 py-2 border rounded-lg hover:bg-gray-50">Cancel</button>
                        <button type="submit" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg flex items-center justify-center" id="saveLinkBtn">
                            <span>Save Link</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <footer class="bg-white border-t border-gray-200 mt-16"><div class="max-w-7xl mx-auto px-4 py-6 text-center text-gray-600"><p>&copy; 2025 Mendo-Kut. All rights reserved.</p></div></footer>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        let dashboardLinks = [];
        let charts = {};
        let lastUpdateTime = null;
        let cuttlyApiKey = '';

        const API = {
            BASE_URL: 'https://cutt.ly/api/api.php',
            PROXY_URL: 'https://corsproxy.io/?',

            fetchLinkAnalytics: async function(shortLink) {
                if (!cuttlyApiKey) return { status: 'error', message: 'API Key is missing.' };
                try {
                    const cacheBuster = new Date().getTime();
                    const targetUrl = `${this.BASE_URL}?key=${cuttlyApiKey}&stats=${shortLink.replace('https://','')}&_=${cacheBuster}`;
                    const res = await fetch(`${this.PROXY_URL}${encodeURIComponent(targetUrl)}`);
                    
                    if (!res.ok) throw new Error(`Proxy error: ${res.status} ${res.statusText}`);
                    
                    const text = await res.text();
                    if (text.startsWith('<')) {
                        throw new Error('Proxy returned a non-JSON response, it may be rate-limited or down.');
                    }
                    const data = JSON.parse(text);
                    
                    console.log(`Cuttly API Response for ${shortLink}:`, data);

                    if (data.stats && (data.stats.status === 1 || data.stats.status === 7)) {
                        return {
                            status: 'success',
                            total: data.stats.clicks || 0,
                            daily: data.stats.byDates?.find(d => d.day === 'Today')?.clicks || 0,
                            yesterday: data.stats.byDates?.find(d => d.day === 'Yesterday')?.clicks || 0,
                            weekly: data.stats.last7Days || 0,
                            monthly: data.stats.last30Days || 0,
                            trend: data.stats.byDates || []
                        };
                    }
                     return { status: 'error', message: this.getCuttlyErrorMessage(data.stats?.status) + ` for ${shortLink}` };
                } catch (err) {
                    console.error(`[API] Fetch stats failed for ${shortLink}:`, err);
                    return { status: 'error', message: err.message || `An unknown network error occurred.`};
                }
            },

            createShortLink: async function(originalUrl, name) {
                if (!cuttlyApiKey) return { status: 'error', message: 'API Key is missing.' };
                try {
                    const targetUrl = `${this.BASE_URL}?key=${cuttlyApiKey}&short=${encodeURIComponent(originalUrl)}&name=${encodeURIComponent(name)}`;
                    const res = await fetch(`${this.PROXY_URL}${encodeURIComponent(targetUrl)}`);

                    if (!res.ok) throw new Error(`Proxy error: ${res.status} ${res.statusText}`);
                    
                    const data = await res.json();
                    if (data.url && data.url.status === 7) {
                        return { status: 'success', data: data.url };
                    } else {
                        return { status: 'error', message: this.getCuttlyErrorMessage(data.url?.status) };
                    }
                } catch (err) {
                    console.error(`[API] Create link failed:`, err);
                    return { status: 'error', message: 'Network error creating link.' };
                }
            },

            getCuttlyErrorMessage: function(status) {
                switch(status) {
                    case 1: return "Shortened link already exists.";
                    case 2: return "The entered URL is not valid.";
                    case 3: return "The preferred link name is already taken.";
                    case 4: return "Invalid API key.";
                    case 5: return "The link has not been shortened.";
                    case 6: return "The link is from a blocked domain.";
                    default: return `Unknown Cuttly API error (status: ${status})`;
                }
            }
        };

        async function initializeDashboard() {
            loadSettings();
            loadLinks();
            setupEventListeners();
            showPage('page-dashboard');
            await refreshData();
        }
        
        async function initializeData() {
            if (!cuttlyApiKey || dashboardLinks.length === 0) {
                if(!cuttlyApiKey) {
                    showNotification('Please add your Cuttly API key in Settings to begin.', 'error');
                    showPage('page-settings');
                }
                updateDashboardUI();
                renderLinksPage();
                return;
            };
        
            const fetchPromises = dashboardLinks.map(async (link) => {
                const analyticsResult = await API.fetchLinkAnalytics(link.shortUrl);
                if(analyticsResult.status === 'success') {
                    return { ...link, ...analyticsResult };
                } else {
                    showNotification(analyticsResult.message, 'error');
                    return { ...link, total: 0, daily: 0, yesterday: 0, weekly: 0, monthly: 0, trend: [] };
                }
            });
            dashboardLinks = await Promise.all(fetchPromises);
        }
        
        function updateDashboardUI() {
            const totalClicks = dashboardLinks.reduce((sum, link) => sum + (link.total || 0), 0);
            const todayClicks = dashboardLinks.reduce((sum, link) => sum + (link.daily || 0), 0);
            const yesterdayClicks = dashboardLinks.reduce((sum, link) => sum + (link.yesterday || 0), 0);
            const weeklyClicks = dashboardLinks.reduce((sum, link) => sum + (link.weekly || 0), 0);
            const monthlyClicks = dashboardLinks.reduce((sum, link) => sum + (link.monthly || 0), 0);
            const activeLinks = dashboardLinks.filter(link => link.status === 'active').length;

            document.getElementById('totalClicks').textContent = formatNumber(totalClicks);
            document.getElementById('todayClicks').textContent = formatNumber(todayClicks);
            document.getElementById('yesterdayClicks').textContent = formatNumber(yesterdayClicks);
            document.getElementById('weeklyClicks').textContent = formatNumber(weeklyClicks);
            document.getElementById('monthlyClicks').textContent = formatNumber(monthlyClicks);
            document.getElementById('activeLinks').textContent = activeLinks;
            
            if (lastUpdateTime) {
                const now = new Date();
                const minutes = Math.floor((now - lastUpdateTime) / 60000);
                document.getElementById('lastUpdate').textContent = minutes < 1 ? 'Just now' : `${minutes}m ago`;
            }
            renderTopLinks();
            initializeOrUpdateCharts();
        }

        function renderLinksPage() {
            const grid = document.getElementById('linksGrid');
            grid.innerHTML = '';
            if (dashboardLinks.length === 0) {
                grid.innerHTML = '<p class="text-gray-500 col-span-full">No links found. Add one to get started!</p>';
                return;
            }
            dashboardLinks.forEach(link => {
                const card = document.createElement('div');
                card.className = 'bg-white rounded-xl shadow-sm p-6 card-hover flex flex-col';
                card.innerHTML = `
                    <div class="flex-grow">
                        <div class="flex items-start justify-between mb-4">
                            <div><h3 class="font-semibold text-gray-900">${link.name}</h3><p class="text-sm text-gray-500 break-all">${link.shortUrl}</p></div>
                            <span class="status-badge status-${link.status}">${link.status}</span>
                        </div>
                        <div class="space-y-3 mb-4 text-sm">
                            <div class="flex justify-between"><span class="text-gray-600">Today</span><span class="font-semibold">${formatNumber(link.daily)}</span></div>
                            <div class="flex justify-between"><span class="text-gray-600">Yesterday</span><span class="font-semibold">${formatNumber(link.yesterday)}</span></div>
                            <div class="flex justify-between"><span class="text-gray-600">Weekly</span><span class="font-semibold">${formatNumber(link.weekly)}</span></div>
                            <div class="flex justify-between"><span class="text-gray-600">Monthly</span><span class="font-semibold">${formatNumber(link.monthly)}</span></div>
                        </div>
                    </div>
                    <div class="mt-auto">
                        <button class="w-full bg-red-100 text-red-700 py-2 px-3 rounded-lg text-sm hover:bg-red-200 transition-colors delete-btn" data-short-url="${link.shortUrl}">Delete</button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }
        
        function renderTopLinks() {
            const container = document.getElementById('topLinksContainer');
            container.innerHTML = '';
            const topLinks = [...dashboardLinks].sort((a, b) => (b.total || 0) - (a.total || 0)).slice(0, 3);
            if (topLinks.length === 0 || !topLinks.some(l => l.total > 0)) {
                 container.innerHTML = '<p class="text-gray-500">No click data available yet.</p>';
                return;
            }
            topLinks.forEach(link => {
                const el = document.createElement('div');
                el.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                el.innerHTML = `<div><p class="font-medium text-gray-900">${link.name}</p><p class="text-sm text-gray-500">${link.shortUrl}</p></div><span class="font-bold text-gray-900">${formatNumber(link.total)}</span>`;
                container.appendChild(el);
            });
        }

        function initializeOrUpdateCharts() {
            const chartDom = document.getElementById('performanceChart');
            if (!chartDom) return;
            
            const trendData = dashboardLinks.reduce((acc, link) => {
                if(link.trend && Array.isArray(link.trend)) {
                    link.trend.slice(0, 30).forEach(day => {
                        const dayLabel = day.day || day.date; 
                        if(dayLabel) {
                           acc[dayLabel] = (acc[dayLabel] || 0) + day.clicks;
                        }
                    });
                }
                return acc;
            }, {});
            
            const chartLabels = Object.keys(trendData).reverse();
            const chartValues = chartLabels.map(label => trendData[label]);

            const option = {
                tooltip: { trigger: 'axis' },
                grid: { left: '3%', right: '4%', bottom: '3%', containLabel: true },
                xAxis: { type: 'category', boundaryGap: false, data: chartLabels },
                yAxis: { type: 'value' },
                series: [{ name: 'Clicks', type: 'line', smooth: true, data: chartValues, areaStyle: { color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [{offset: 0, color: 'rgba(74, 144, 164, 0.3)'}, {offset: 1, color: 'rgba(74, 144, 164, 0.05)'}])}}]
            };
            if (!charts.performance) {
                charts.performance = echarts.init(chartDom);
                window.addEventListener('resize', () => charts.performance.resize());
            }
            charts.performance.setOption(option, true);
        }

        function setupEventListeners() {
            document.querySelectorAll('.nav-tab[data-page]').forEach(tab => tab.addEventListener('click', () => showPage(tab.dataset.page)));
            document.getElementById('refreshBtn').addEventListener('click', refreshData);
            document.getElementById('addLinkBtn').addEventListener('click', () => showLinkModal());
            document.getElementById('mobileMenuBtn').addEventListener('click', () => document.getElementById('mobileMenu').classList.toggle('hidden'));
            document.getElementById('closeModal').addEventListener('click', hideLinkModal);
            document.getElementById('cancelBtn').addEventListener('click', hideLinkModal);
            document.getElementById('linkForm').addEventListener('submit', handleFormSubmit);
            document.getElementById('saveSettings').addEventListener('click', saveSettings);
            document.getElementById('linksGrid').addEventListener('click', e => {
                if (e.target.classList.contains('delete-btn')) {
                    const urlToDelete = e.target.dataset.shortUrl;
                    deleteLink(urlToDelete);
                }
            });
        }
        
        async function refreshData() {
            const btn = document.getElementById('refreshBtn');
            btn.disabled = true;
            btn.classList.add('animate-spin');
            showNotification('Refreshing data...', 'success');
            await initializeData();
            lastUpdateTime = new Date();
            updateDashboardUI();
            renderLinksPage();
            btn.disabled = false;
            btn.classList.remove('animate-spin');
        }

        async function handleFormSubmit(e) {
            e.preventDefault();
            const name = document.getElementById('linkName').value;
            const url = document.getElementById('originalUrl').value;
            const saveBtn = document.getElementById('saveLinkBtn');

            if (!cuttlyApiKey) {
                showNotification('Please add your Cuttly API key in Settings before creating links.', 'error');
                showPage('page-settings');
                return;
            }

            saveBtn.disabled = true;
            saveBtn.innerHTML = `<svg class="animate-spin h-5 w-5 text-white" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>`;
            
            const result = await API.createShortLink(url, name);
            
            if (result.status === 'success') {
                const newLinkData = result.data;
                const newLink = { name: newLinkData.title, shortUrl: newLinkData.shortLink, status: 'active' };
                dashboardLinks.push(newLink);
                saveLinks();
                hideLinkModal();
                showNotification(`Link '${name}' created successfully.`, 'success');
                await refreshData();
            } else {
                showNotification(`Error: ${result.message}`, 'error');
            }
            saveBtn.disabled = false;
            saveBtn.innerHTML = '<span>Save Link</span>';
        }

        function deleteLink(shortUrl) {
            if (confirm(`Are you sure you want to delete ${shortUrl}? This cannot be undone.`)) {
                dashboardLinks = dashboardLinks.filter(link => link.shortUrl !== shortUrl);
                saveLinks();
                renderLinksPage();
                updateDashboardUI();
                showNotification('Link deleted.', 'success');
            }
        }

        function showPage(pageId) {
            document.querySelectorAll('.page-container').forEach(p => p.classList.add('hidden'));
            document.getElementById(pageId).classList.remove('hidden');
            document.querySelectorAll('.nav-tab[data-page]').forEach(tab => tab.classList.toggle('active', tab.dataset.page === pageId));
            document.getElementById('mobileMenu').classList.add('hidden');
        }

        function showLinkModal() {
            document.getElementById('linkForm').reset();
            document.getElementById('modalTitle').textContent = 'Add New Link';
            document.getElementById('linkModal').classList.remove('hidden');
            document.getElementById('linkModal').classList.add('flex');
        }

        function hideLinkModal() {
            document.getElementById('linkModal').classList.add('hidden');
            document.getElementById('linkModal').classList.remove('flex');
        }
        
        function loadLinks() {
            const savedLinks = localStorage.getItem('dashboardLinks');
            if (savedLinks) {
                dashboardLinks = JSON.parse(savedLinks);
            } else {
                // Default links if nothing is saved
                dashboardLinks = [
                    { name: "GiriÅŸ Bot", shortUrl: "https://cutt.ly/2rJxA8Z3", status: "active" },
                    { name: "Mail Abonelik", shortUrl: "https://cutt.ly/TrM8Utl8", status: "active" },
                    { name: "Fikret SMS", shortUrl: "https://cutt.ly/75OTL", status: "active" },
                ];
                saveLinks();
            }
        }

        function saveLinks() {
            localStorage.setItem('dashboardLinks', JSON.stringify(dashboardLinks));
        }

        function loadSettings() {
            const savedKey = localStorage.getItem('cuttlyApiKey');
            if (savedKey) {
                cuttlyApiKey = savedKey;
                document.getElementById('apiKey').value = savedKey;
            }
        }
        function saveSettings() {
            const key = document.getElementById('apiKey').value;
            if (key) {
                cuttlyApiKey = key;
                localStorage.setItem('cuttlyApiKey', key);
                showNotification('Settings saved successfully!', 'success');
                refreshData();
            } else {
                showNotification('API Key cannot be empty.', 'error');
            }
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('en-US', { notation: 'compact', compactDisplay: 'short' }).format(num || 0);
        }

        function showNotification(message, type = 'success') {
            const colors = { success: 'bg-green-500', error: 'bg-red-500' };
            const notification = document.createElement('div');
            notification.className = `fixed bottom-5 right-5 px-6 py-3 rounded-lg shadow-lg text-white z-50 slide-up ${colors[type]}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.transition = 'opacity 0.5s ease';
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 500);
            }, 5000); // Increased timeout for error messages
        }

        initializeDashboard();
    });
    </script>
</body>
</html>

